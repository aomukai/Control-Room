<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control Room</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Monaco Editor -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/editor/editor.main.min.css">
</head>
<body>
    <div id="app">
        <!-- Left Sidebar -->
        <div id="left-sidebar">
            <div class="sidebar-header">Control Room</div>
            <div class="sidebar-buttons">
                <button class="sidebar-btn" id="btn-commit" title="Commit (Save All)">
                    <span class="btn-icon">üíæ</span>
                    <span class="btn-text">Commit (Save)</span>
                </button>
                <button class="sidebar-btn" id="btn-scenes" title="Scenes">
                    <span class="btn-icon">üé¨</span>
                    <span class="btn-text">Scenes</span>
                </button>
                <button class="sidebar-btn" id="btn-chars" title="Characters">
                    <span class="btn-icon">üë§</span>
                    <span class="btn-text">Chars</span>
                </button>
                <button class="sidebar-btn" id="btn-etc" title="More">
                    <span class="btn-icon">üìÅ</span>
                    <span class="btn-text">Etc</span>
                </button>
                <button class="sidebar-btn" id="btn-open-workspace" title="Open Workspace Folder">
                    <span class="btn-icon">üìÇ</span>
                    <span class="btn-text">Open Workspace Folder</span>
                </button>
                <button class="sidebar-btn" id="btn-open-terminal" title="Open Terminal Here">
                    <span class="btn-icon">üíª</span>
                    <span class="btn-text">Open Terminal Here</span>
                </button>
            </div>
            <div class="sidebar-divider"></div>
            <div class="file-tree-header">
                Files
                <div class="tree-actions">
                    <button class="tree-action-btn" id="btn-new-file" title="New File">+üìÑ</button>
                    <button class="tree-action-btn" id="btn-new-folder" title="New Folder">+üìÅ</button>
                    <button class="tree-action-btn" id="btn-refresh-tree" title="Refresh">üîÑ</button>
                </div>
            </div>
            <div id="file-tree"></div>
        </div>

        <!-- Main Container with Top Bar -->
        <div id="main-container">
            <!-- Top Bar Mode Switch -->
            <div id="top-bar">
                <div id="top-bar-tabs">
                    <button class="top-bar-tab" id="tab-workbench" data-mode="workbench" type="button">
                        <span class="tab-icon">üéõÔ∏è</span>
                        <span class="tab-label">Workbench</span>
                    </button>
                    <button class="top-bar-tab active" id="tab-editor" data-mode="editor" type="button">
                        <span class="tab-icon">‚úèÔ∏è</span>
                        <span class="tab-label">Editor</span>
                    </button>
                    <button class="top-bar-tab" id="tab-settings" data-mode="settings" type="button">
                        <span class="tab-icon">‚öôÔ∏è</span>
                        <span class="tab-label">Settings</span>
                    </button>
                </div>
                <div id="top-bar-right">
                    <span id="top-bar-project-name">Control Room</span>
                </div>
            </div>

            <!-- View Container (Editor or Workbench) -->
            <div id="view-container">
                <!-- Editor View (existing) -->
                <div id="editor-view" class="view-panel active">
                    <!-- Horizontal Split: Main Area and Chat Panel -->
                    <div id="main-split">
                <!-- Center Area (Editor + Bottom Console) -->
                <div id="center-area">
                    <!-- Top Tab Strip -->
                    <div id="tab-strip">
                        <div class="tab-strip-label">file Navigation (open files tabs)</div>
                        <div id="tabs-container"></div>
                        <div class="tab-strip-actions">
                            <button class="tab-action-btn" id="btn-find" title="Find in File (Ctrl+F)" disabled aria-label="Find in File (Ctrl+F)">
                                <span class="btn-icon">üîç</span>
                                <span class="btn-text">Find</span>
                            </button>
                            <button class="tab-action-btn" id="btn-search" title="Search in Workspace (Ctrl+Shift+F)" aria-label="Search in Workspace (Ctrl+Shift+F)">
                                <span class="btn-icon">üîé</span>
                                <span class="btn-text">Search</span>
                            </button>
                            <button class="tab-action-btn" id="btn-reveal-file" title="Reveal File in Explorer" disabled>
                                <span class="btn-icon">üìç</span>
                                <span class="btn-text">Reveal File</span>
                            </button>
                            <button class="tab-action-btn" id="btn-open-folder" title="Open Containing Folder" disabled>
                                <span class="btn-icon">üìÇ</span>
                                <span class="btn-text">Open Folder</span>
                            </button>
                        </div>
                    </div>

                    <!-- Vertical Split: Editor and Console -->
                    <div id="editor-console-split">
                        <!-- Editor Area -->
                        <div id="editor-area">
                            <div id="editor-placeholder">
                                <div class="placeholder-text">
                                    <h2>Welcome to Control Room</h2>
                                    <p>Select a file from the sidebar to start editing</p>
                                    <p class="shortcut">Ctrl+S to save</p>
                                </div>
                            </div>
                            <div id="monaco-editor"></div>
                        </div>

                        <!-- Bottom Console -->
                        <div id="bottom-console">
                            <div class="console-tabs">
                                <button class="console-tab active" data-tab="console">Console</button>
                                <button class="console-tab" data-tab="ai-actions">AI Actions</button>
                                <button class="console-tab" data-tab="search">Search</button>
                            </div>
                            <div class="console-content">
                                <!-- Console Tab -->
                                <div id="console-panel" class="console-panel active">
                                    <div id="console-output"></div>
                                </div>

                                <!-- AI Actions Tab -->
                                <div id="ai-actions-panel" class="console-panel">
                                    <div class="ai-actions-header">Proposed Changes</div>
                                    <div id="ai-actions-list">
                                        <div class="ai-action-item">
                                            <div class="ai-action-info">
                                                <span class="ai-action-file">scenes/intro.md</span>
                                                <span class="ai-action-desc">Add more sensory details to the coffee shop scene</span>
                                            </div>
                                            <div class="ai-action-buttons">
                                                <button class="ai-action-btn preview" data-action="preview-1">Preview</button>
                                                <button class="ai-action-btn apply" data-action="apply-1">Apply</button>
                                                <button class="ai-action-btn reject" data-action="reject-1">Reject</button>
                                            </div>
                                        </div>
                                        <div class="ai-action-item">
                                            <div class="ai-action-info">
                                                <span class="ai-action-file">chars/mara.md</span>
                                                <span class="ai-action-desc">Expand character backstory section</span>
                                            </div>
                                            <div class="ai-action-buttons">
                                                <button class="ai-action-btn preview" data-action="preview-2">Preview</button>
                                                <button class="ai-action-btn apply" data-action="apply-2">Apply</button>
                                                <button class="ai-action-btn reject" data-action="reject-2">Reject</button>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="diff-preview" class="hidden">
                                        <div class="diff-header">
                                            <span>Diff Preview</span>
                                            <button id="close-diff">√ó</button>
                                        </div>
                                        <pre id="diff-content"></pre>
                                    </div>
                                </div>

                                <!-- Search Tab -->
                                <div id="search-panel" class="console-panel">
                                    <div class="search-input-container">
                                        <input type="text" id="search-input" placeholder="Search in workspace...">
                                        <button id="search-btn">Search</button>
                                    </div>
                                    <div id="search-results"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Status Bar -->
                    <div id="status-bar">
                        <div id="status-left">
                            <span id="status-text">Ready</span>
                            <button id="status-alert" class="hidden" type="button"></button>
                        </div>
                        <div id="status-right">
                            <button id="notification-bell" type="button" title="Notifications">Bell</button>
                            <span id="notification-count" class="hidden">0</span>
                        </div>
                    </div>
                </div>

                <!-- Right Chat Panel -->
                <div id="chat-panel">
                    <div class="chat-header">Chat with AI</div>
                    <div id="chat-history"></div>
                    <div class="chat-input-container">
                        <textarea id="chat-input" placeholder="Ask the AI assistant..."></textarea>
                        <button id="chat-send">Send</button>
                    </div>
                </div>
                    </div>
                </div>
                <!-- End Editor View -->

                <!-- Workbench View -->
                <div id="workbench-view" class="view-panel">
                    <div id="workbench-layout">
                        <!-- Agent Sidebar -->
                        <div id="workbench-agent-sidebar">
                            <div class="workbench-panel-header">
                                <span class="panel-title">Agents</span>
                            </div>
                            <div id="agent-list" class="agent-list">
                                <!-- Will be populated by JS -->
                            </div>
                        </div>

                        <!-- Chat / Discussion Pane -->
                        <div id="workbench-chat-pane">
                            <div class="workbench-panel-header">
                                <span class="panel-title">Discussion</span>
                            </div>
                            <div id="workbench-chat-content">
                                <!-- Placeholder content -->
                            </div>
                        </div>

                        <!-- Newsfeed Panel -->
                        <div id="workbench-newsfeed">
                            <div class="workbench-panel-header">
                                <span class="panel-title">Newsfeed</span>
                            </div>
                            <div id="newsfeed-list">
                                <!-- Will be populated by JS from NotificationStore -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Workbench View -->

                <!-- Settings View (placeholder) -->
                <div id="settings-view" class="view-panel">
                    <div id="settings-content">
                        <div class="settings-placeholder">
                            <h2>Settings</h2>
                            <p>Settings panel coming soon.</p>
                        </div>
                    </div>
                </div>
                <!-- End Settings View -->

            </div>
            <!-- End View Container -->
        </div>
    </div>

    <!-- Toast Stack -->
    <div id="toast-stack"></div>

    <!-- Notification Center -->
    <div id="notification-center" class="hidden" aria-hidden="true">
        <div class="notification-center-header">
            <div class="notification-center-title">Notifications</div>
            <div class="notification-center-actions">
                <button id="notification-mark-read" type="button">Mark all read</button>
                <button id="notification-clear-non-errors" type="button">Clear non-errors</button>
                <button id="notification-close" type="button">Close</button>
            </div>
        </div>
        <div class="notification-filters">
            <div class="notification-filter-group" id="notification-filter-levels">
                <span class="filter-label">Levels</span>
                <label><input type="checkbox" data-level="info" checked>Info</label>
                <label><input type="checkbox" data-level="success" checked>Success</label>
                <label><input type="checkbox" data-level="warning" checked>Warning</label>
                <label><input type="checkbox" data-level="error" checked>Error</label>
            </div>
            <div class="notification-filter-group" id="notification-filter-scopes">
                <span class="filter-label">Scopes</span>
                <label><input type="checkbox" data-scope="global" checked>Global</label>
                <label><input type="checkbox" data-scope="workbench" checked>Workbench</label>
                <label><input type="checkbox" data-scope="editor" checked>Editor</label>
                <label><input type="checkbox" data-scope="terminal" checked>Terminal</label>
                <label><input type="checkbox" data-scope="jobs" checked>Jobs</label>
            </div>
        </div>
        <div id="notification-list"></div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/split.js/1.6.5/split.min.js"></script>
    <script>
        // Load Monaco
        var require = { paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs' } };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/loader.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/editor/editor.main.nls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.44.0/min/vs/editor/editor.main.js"></script>
    <script src="app.js"></script>
</body>
</html>
